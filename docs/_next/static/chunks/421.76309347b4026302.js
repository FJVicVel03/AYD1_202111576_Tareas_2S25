"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[421],{3421:function(e,a,t){t.r(a),t.d(a,{default:function(){return j}});var l=t(5893),r=t(7294),o=t(5715),n=t(2013),i=t(269),s=t(4049),d=t(8798),u=t(7262),c=t(4961),p=t(7066);let h=[14.6349,-90.5069],m=[14.609,-90.5269],f=[14.6514,-90.4923],b=[m,[14.6118,-90.5246],[14.6142,-90.5215],[14.6168,-90.5188],[14.6185,-90.516],[14.6196,-90.5128],[14.621,-90.5101],[14.6234,-90.5078],[14.6262,-90.5054],[14.629,-90.5035],[14.6317,-90.5018],[14.6346,-90.5],[14.6375,-90.4986],[14.641,-90.4973],[14.6445,-90.4961],[14.6479,-90.4948],[14.65,-90.4938],f],g=[m,[14.6118,-90.5246],[14.6142,-90.5215],[14.6168,-90.5188],[14.6179,-90.5148],[14.6194,-90.5112],[14.6212,-90.5079],[14.6236,-90.5045],[14.6268,-90.5019],[14.6302,-90.4998],[14.6334,-90.4984],[14.6366,-90.4972],[14.6402,-90.496],[14.6438,-90.4949],[14.6471,-90.4937],f],v={"muy-alta":"#ff5f6d",alta:"#ff9966",media:"#ffd56f",baja:"#8bd46e"},x=[{center:[14.659,-90.486],level:"muy-alta",label:"Zona 18 (simulado)"},{center:[14.645,-90.574],level:"muy-alta",label:"Mixco - Calz. San Juan (simulado)"},{center:[14.611,-90.551],level:"alta",label:"Nudo El Trebol (simulado)"},{center:[14.626,-90.559],level:"alta",label:"Calzada Roosevelt (simulado)"},{center:[14.634,-90.508],level:"alta",label:"Centro/Zona 4-9 (simulado)"},{center:[14.623,-90.532],level:"media",label:"Zona 3 - Mercado (simulado)"},{center:[14.613,-90.535],level:"media",label:"Zona 1 (simulado)"},{center:[14.65,-90.502],level:"media",label:"Carretera a Chinautla (simulado)"},{center:[14.481,-90.587],level:"alta",label:"Villa Nueva - Barcena (simulado)"},{center:[14.603,-90.488],level:"baja",label:"Zona 10 - Reforma (simulado)"},{center:[14.618,-90.505],level:"baja",label:"Zona 9 - Obelisco (simulado)"},{center:[14.644,-90.509],level:"baja",label:"Zona 15 - Vista Hermosa (simulado)"}],y=[{points:[[14.62,-90.53],[14.623,-90.523],[14.617,-90.518],[14.614,-90.525]]}];function M(e,a){let t=(a[0]-e[0])*Math.PI/180,l=(a[1]-e[1])*Math.PI/180;return 12742e3*Math.asin(Math.sqrt(Math.sin(t/2)*Math.sin(t/2)+Math.sin(l/2)*Math.sin(l/2)*Math.cos(e[0]*Math.PI/180)*Math.cos(a[0]*Math.PI/180)))}function k(e,a,t,l){for(let r=0;r<=12;r++){let o=r/12,n=e[0]+(a[0]-e[0])*o,i=e[1]+(a[1]-e[1])*o;for(let e of t)if(M([n,i],e.center)<=e.radius)return!0;for(let e of l)if(function(e,a){let[t,l]=e,r=!1;for(let e=0,o=a.length-1;e<a.length;o=e++){let n=a[e][0],i=a[e][1],s=a[o][0],d=a[o][1];i>l!=d>l&&t<(s-n)*(l-i)/(d-i||1e-12)+n&&(r=!r)}return r}([n,i],e))return!0}return!1}function j(e){let{className:a,showTiles:t=!0,useRouting:j=!0}=e,[C,w]=(0,r.useState)([]),[S,I]=(0,r.useState)(null),[z,O]=(0,r.useState)(!1),[R,E]=(0,r.useState)({distanceMeters:null,durationSec:null,source:"mock",provider:null}),Z=(e,a)=>[a,e],P=(0,r.useCallback)(function(e,a,t){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,r=[],o=t/111320,n=t/(111320*Math.max(.3,Math.cos(e*Math.PI/180)));for(let t=0;t<=l;t++){let i=t/l*2*Math.PI,s=e+Math.sin(i)*o,d=a+Math.cos(i)*n;r.push([d,s])}return r},[]),N=(0,r.useCallback)(e=>{if(!e||e.length<2)return!1;let a={"muy-alta":550,alta:450,media:350},t=x.filter(e=>"muy-alta"===e.level||"alta"===e.level||"media"===e.level).map(e=>({center:e.center,radius:a[e.level]||300})),l=y.map(e=>e.points);for(let a=0;a<e.length-1;a++)if(k(e[a],e[a+1],t,l))return!0;return!1},[]),W=(0,r.useCallback)(()=>{let e=y.map(e=>[...e.points.map(e=>Z(e[0],e[1])),Z(e.points[0][0],e.points[0][1])]);if(z){let a={"muy-alta":550,alta:450,media:350};x.forEach(t=>{if("muy-alta"===t.level||"alta"===t.level||"media"===t.level){let[l,r]=t.center,o=P(l,r,a[t.level]);e.push(o)}})}return 0===e.length?null:1===e.length?{type:"Polygon",coordinates:[e[0]]}:{type:"MultiPolygon",coordinates:e.map(e=>[e])}},[z,P]),_=(0,r.useCallback)(e=>{if(!e||e.length<2)return 0;let a=0;for(let t=0;t<e.length-1;t++)a+=M(e[t],e[t+1]);return a},[]),A=(0,r.useCallback)(async()=>{var e,a,t,l,r;if(!j){let e=_(z?g:b);E({distanceMeters:Math.round(e),durationSec:Math.round(e/8.33),source:"mock",provider:null});return}let o=[m[1],m[0]],n=[f[1],f[0]],i=W();try{let l=await p.Z.post("/api/ors-route",{start:o,end:n,avoid_polygons:i||void 0}),r=(null==l?void 0:null===(e=l.data)||void 0===e?void 0:e.coordinates)||[];if(r.length){let e=r.map(e=>[e[1],e[0]]);if(z&&N(e)){w([]),I("Ruta externa intersecta zonas a evitar \xb7 usando alternativa segura");let e=_(g);E({distanceMeters:Math.round(e),durationSec:Math.round(e/8.33),source:"mock",provider:null});return}w(e),I(null);let o=null==l?void 0:null===(a=l.data)||void 0===a?void 0:a.summary,n=(null==l?void 0:null===(t=l.data)||void 0===t?void 0:t.provider)||"ors";if(o&&(o.distance||o.duration))E({distanceMeters:Math.round(o.distance||0),durationSec:Math.round(o.duration||0),source:"ors",provider:n});else{let a=_(e);E({distanceMeters:Math.round(a),durationSec:Math.round(a/8.33),source:"estimate",provider:n})}return}throw Error("Respuesta del proxy sin coordenadas")}catch(a){console.error("Error obteniendo ruta desde proxy /api/ors-route:",a),I((null==a?void 0:null===(r=a.response)||void 0===r?void 0:null===(l=r.data)||void 0===l?void 0:l.error)||(null==a?void 0:a.message)||"Error de ruteo");let e=_(z?g:b);E({distanceMeters:Math.round(e),durationSec:Math.round(e/8.33),source:"mock",provider:null})}},[j,z,W,_]);(0,r.useEffect)(()=>{A()},[A]);let F=(0,r.useMemo)(()=>{let e={"muy-alta":550,alta:450,media:350,baja:250};return x.map(a=>({center:a.center,radius:e[a.level]||300}))},[]),V=(0,r.useMemo)(()=>y.map(e=>e.points),[]),q=C.length?C:z?g:b,B=(0,r.useMemo)(()=>{let e=[];for(let a=0;a<q.length-1;a++){let t=q[a],l=q[a+1];e.push({a:t,b:l,risky:k(t,l,F,V)})}return e},[F,V,q]),D=B.some(e=>e.risky);return(0,l.jsxs)("div",{className:a,style:{width:"100%",height:"100%"},children:[(0,l.jsxs)(o.h,{center:h,zoom:13,style:{width:"100%",height:"100%",background:"#eef3f8"},zoomControl:!0,scrollWheelZoom:!0,children:[t&&(0,l.jsx)(n.I,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"\xa9 <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors"}),x.map((e,a)=>{let t=v[e.level]||"#ff9966",r="muy-alta"===e.level?550:"alta"===e.level?450:"media"===e.level?350:250,o="muy-alta"===e.level?.28:"alta"===e.level?.24:"media"===e.level?.22:.18;return(0,l.jsx)(i.C,{center:e.center,radius:r,pathOptions:{color:t,fillColor:t,fillOpacity:o,weight:2},children:(0,l.jsxs)(s.u,{children:[e.label," â€” Incidencia ",e.level.replace("-"," ")]})},"heat-".concat(a))}),y.map((e,a)=>(0,l.jsx)(d.m,{positions:e.points,pathOptions:{color:"#b91c1c",fillColor:"#ef4444",fillOpacity:.2,dashArray:"6 6"},children:(0,l.jsx)(s.u,{children:"Area de riesgo"})},"hz-p-".concat(a))),B.map((e,a)=>(0,l.jsx)(u.a,{positions:[e.a,e.b],pathOptions:{color:e.risky?"#dc2626":"#2563eb",weight:5,opacity:e.risky?.95:.85}},"seg-".concat(a))),(0,l.jsx)(c.c,{center:m,radius:8,pathOptions:{color:"#16a34a",fillColor:"#16a34a",fillOpacity:1},children:(0,l.jsx)(s.u,{children:"Origen"})}),(0,l.jsx)(c.c,{center:f,radius:8,pathOptions:{color:"#7c3aed",fillColor:"#7c3aed",fillOpacity:1},children:(0,l.jsx)(s.u,{children:"Destino"})})]}),(0,l.jsxs)("div",{style:{position:"absolute",right:12,top:12,zIndex:500,background:"rgba(16,24,40,0.85)",color:"white",padding:"10px 12px",borderRadius:10,boxShadow:"0 6px 18px rgba(0,0,0,0.25)",display:"flex",alignItems:"center",gap:10,fontWeight:600},children:[(0,l.jsx)("button",{onClick:()=>O(e=>!e),style:{background:z?"rgba(34,197,94,0.95)":"rgba(30,58,138,0.95)",color:"white",border:"none",borderRadius:8,padding:"6px 10px",cursor:"pointer",fontWeight:700},children:z?"Evitar zonas peligrosas: ON":"Evitar zonas peligrosas"}),(0,l.jsx)("span",{style:{opacity:.9},children:null!=R.distanceMeters&&null!=R.durationSec?"".concat((R.distanceMeters/1e3).toFixed(1)," km \xb7 ").concat((R.durationSec/60).toFixed(0)," min"):"---"})]}),D&&(0,l.jsx)("div",{style:{position:"absolute",left:12,bottom:12,zIndex:400,background:"rgba(220,38,38,0.95)",color:"white",padding:"8px 12px",borderRadius:10,boxShadow:"0 6px 18px rgba(0,0,0,0.2)",display:"flex",alignItems:"center",gap:10,fontWeight:600},children:(0,l.jsx)("span",{children:"Riesgo: la ruta se aproxima a zonas peligrosas."})}),S&&(0,l.jsxs)("div",{style:{position:"absolute",right:12,bottom:12,zIndex:400,background:"rgba(30,58,138,0.95)",color:"white",padding:"8px 12px",borderRadius:10,boxShadow:"0 6px 18px rgba(0,0,0,0.2)",display:"flex",alignItems:"center",gap:12,fontWeight:600,pointerEvents:"auto"},children:[(0,l.jsxs)("span",{children:["Ruta simulada \xb7 ",S]}),(0,l.jsx)("button",{onClick:()=>A(),style:{background:"rgba(234, 179, 8, 0.95)",color:"#111827",border:"none",borderRadius:8,padding:"6px 10px",cursor:"pointer",fontWeight:700},children:"Reintentar"})]})]})}}}]);